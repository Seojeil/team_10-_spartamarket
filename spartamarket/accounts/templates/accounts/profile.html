{% extends 'base.html' %}

{%block content%}

<!-- 프로필 -->
<h1> {{ user.username }} 의 프로필 페이지 </h1><br>
<p>
    유저네임 : {{ user.username }}<br>
    email : {{ user.email }}
</p>

<!-- 프로필 사진 -->
<img src="{{ user.image.url }}" alt="profile_image" width="300" height="350">

<!-- 사용자 정보 수정 -->
{% if request.user.username == user.username %}
<p><br>
    <a href="{% url 'accounts:modify' %}">
        <button>내 정보 수정</button>
    </a>
</p>

<!-- 회원 탈퇴 -->
<p>
    <form action= "{% url 'accounts:delete' %}" method='POST'>
        {% csrf_token %}
        <button type='submit'>회원 탈퇴</button>
    </form>
</p>
{% else %}
{% endif %}

<!-- 팔로우 기능 -->
<div>
    <div>
        팔로잉 : {{ user.followings.count }} / 팔로워 : {{ user.followers.all|length }}
    </div>

    {% if request.user != user %}
    <div>
        <form action="{% url 'accounts:follow' user.username%}" method='POST'>
        {% csrf_token %}
        {% if request.user in user.followers.all %}
            <input type="submit" value='팔로우 취소'>
        {% else %}
            <input type="submit" value='팔로우'>
        {% endif %}
        </form>
    </div>
    {% endif %}
</div>
<div>
    <p>팔로워 리스트:</p>
    {% for follower in user.followers.all %}
        <p>{{ follower.username }}</p>
    {% endfor %}
</div>

<!-- 찜, 작성글 보기 및 목록 설정 -->
<form method="POST">
    {% csrf_token %}
    <select name="product_option" id="product_option">
        <option value="liked">찜목록 보기</option>
        <option value="all">작성글 보기</option>
    </select>
    <button type="submit">확인</button>
</form><br>
{% if option == 'all' %}
<h3>{{ user.username }}님이 작성한 글 목록</h3>
{% else %}
<h3>{{ user.username }}님이 찜한 목록</h3>
{% endif %}
<hr>
{% for product in products %}
<h3>
    <a href='{% url "products:details" product.pk %}'>
        {{ product.title }}
    </a> 
    [{{ product.comments.count }}]
</h3>
<p>
    조회수: {{ product.hits }}
</p>
<p>
    찜한 사람: {{ product.like_users.count }} 명
</p>
<p>
    작성자: 
    <a href="{% url 'accounts:profile' username=product.author %}">
        {{ product.author }}
    </a>
</p>
<p>
    작성시간: {{ product.created_at }}
</p>
<hr>
{% endfor %}


{%endblock content%}

