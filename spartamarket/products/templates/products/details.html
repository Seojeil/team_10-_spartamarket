{% extends "base.html" %}

{% block content %}
<h1> {{ product.title }} </h1>
<p>상태: {{ product.status }}</p> 
<p>
    조회수: {{ product.hits }}
</p>
<p>
    작성자: 
    <a href="{% url 'accounts:profile' product.author.username %}">
        {{ product.author.username }}</a>
</p>
{% if request.user == product.author %}
<form action="{% url 'products:delete' product.pk %}" method='POST'>
    {% csrf_token %}
    <button type='submit'>게시글 삭제</button>
</form>

<p>
    <a href='{% url 'products:update' product.pk %}'>
        <button>게시글 수정</button>
    </a>
</p>
{% endif %}
<p>
    {% if product.image %}
        <img src="{{ product.image.url }}">
    {% endif %}
</p>

<p>
    {{ product.content }}
</p>

<p>
    {{ product.created_at }}
</p>

<p>
    가격: ￦ {{ product.price }} 
</p>

<p>
    {% if product.hashtags %}
        {% for hashtag in hashtags %}
            <a href="{% url 'index' %}?search={{ hashtag.name }}&search_type=hashtag">
                #{{ hashtag }}
            </a>&nbsp;
        {% endfor %}
    {% endif %}
</p>

<p>
    <a href="{% url 'index' %}">
        <button>글목록으로</button>
    </a>
</p>

<p>
    이 상품을 찜한 사람: {{ product.like_users.count }} 명
</p>
<!-- 찜하기 기능 -->
{% if request.user.is_authenticated %}
<p>
    <form action="{% url 'products:like' product.pk %}" method='POST'>
        {% csrf_token %}
    {% if request.user in product.like_users.all %}
    <button class="btn btn-link text-danger">
        <i class="fa-solid fa-heart fa-2x"></i>
    </button>
    {% else %}
    <button class="btn btn-link text-dark">
        <i class="fa-regular fa-heart fa-2x"></i>
    </button>
    {% endif %}
    </form>
</p>

<p>
    <form action="{% url 'products:comments' product.pk %}" method='POST'>
        {% csrf_token %}
        {{ comment_form.as_p }}
        <button type='submit'>댓글 작성</button>
    </form>
</p>
{% else %}
<p>
    <a href="{% url 'accounts:login' %}?next={{ request.path }}">
        <button>로그인하고 서비스 이용하기</button>
    </a>
</p>
{% endif %}
<hr>
<p>
    {% for comment in comments %}
    {{ comment.content }}<br>
    <p>
        작성자: 
        <a href="{% url 'accounts:profile' comment.author.username %}">
            {{ comment.author.username }}</a>
    </p>
    작성시간: {{ comment.created_at }}
    {% if request.user == comment.author %}
    <form action="{% url 'products:comments_delete' comment.pk %}" method='POST'>
        {% csrf_token %}
        <button type='submit'>댓글 삭제</button>
    </form>
    {% endif %}
    <hr>
    {% endfor %}
</p>

{% endblock content %}